{{- $view := or .design.view "custom_view_a" -}}
{{- $tpl  := printf "views/%s.html" $view -}}

{{- $lang := site.Language.Lang -}}
{{- with .Page }}{{- $lang = .Language.Lang -}}{{- end -}}

{{- /* 모든 정규 페이지 가져오기 */ -}}
{{- $all := where site.RegularPages "Lang" $lang -}}
{{- $all = where $all "Draft" "!=" true -}}

{{- /* 폴더 필터링 */ -}}
{{- $folders := .content.filters.folders | default (slice) -}}
{{- $pages := slice -}}

{{- if gt (len $folders) 0 -}}
  {{- range $folder := $folders -}}
    {{- $folderPages := where $all "Section" $folder -}}
    {{- /* Type 필터 추가 */ -}}
    {{- $folderPages = where $folderPages "Type" $folder -}}
    {{- $pages = $pages | append $folderPages -}}
  {{- end -}}
{{- else -}}
  {{- $pages = $all -}}
{{- end -}}

{{- /* kind 필터 (있는 경우) */ -}}
{{- with .content.filters.kind -}}
  {{- $pages = where $pages "Kind" . -}}
{{- end -}}

{{- /* exclude_featured 필터 (있는 경우) */ -}}
{{- with .content.filters.exclude_featured -}}
  {{- if eq . true -}}
    {{- $pages = where $pages "Params.featured" "!=" true -}}
  {{- end -}}
{{- end -}}

{{- /* tag 필터 (있는 경우) */ -}}
{{- with .content.filters.tag -}}
  {{- $pages = where $pages "Params.tags" "intersect" (slice .) -}}
{{- end -}}

{{- /* 날짜순 정렬 */ -}}
{{- $pages = sort $pages "Date" "desc" -}}

{{- /* 개수 제한 */ -}}
{{- $n := or .content.count 9 -}}
{{- $pages = first $n $pages -}}

{{- /* 각 페이지를 해당 뷰 템플릿으로 렌더링 */ -}}
{{- range $pages -}}
  {{ partial $tpl (dict "page" .) }}
{{- end -}}