{{- /* 1. 뷰(a,b,c) 설정을 가져옵니다. (기본값: custom_view_a) */ -}}
{{- $view := or .design.view "custom_view_a" -}}
{{- $tpl  := printf "views/%s.html" $view -}}

{{- /* 2. 언어 설정을 가져옵니다. */ -}}
{{- $lang := site.Language.Lang -}}
{{- with .Page }}{{- $lang = .Language.Lang -}}{{- end -}}

{{- /* 3. 사이트의 모든 일반 페이지(draft가 아닌)를 가져옵니다. */ -}}
{{- $all := where site.RegularPages "Lang" $lang -}}
{{- $all = where $all "Draft" "!=" true -}}

{{- /* 4. (핵심 수정) _index.md에서 지정한 'folders'로 필터링합니다. */ -}}
{{- $folders := .content.filters.folders | default (slice) -}}
{{- $pages := slice -}}

{{- if gt (len $folders) 0 -}}
  {{- /* 'folders' (hobby, study 등)가 지정된 경우 */ -}}
  {{- range $folder := $folders -}}
    {{- /* $all(전체) 페이지에서 'Section'(폴더명)이 일치하는 것만 찾습니다. */ -}}
    {{- $folderPages := where $all "Section" $folder -}}

    {{- /* 🚨 문제의 'Type' 필터를 여기서 제거했습니다. 🚨 */ -}}

    {{- $pages = $pages | append $folderPages -}}
  {{- end -}}
{{- else -}}
  {{- /* 'folders'가 없으면, 모든 페이지를 대상으로 합니다. */ -}}
  {{- $pages = $all -}}
{{- end -}}

{{- /* 5. 날짜순으로 정렬합니다. */ -}}
{{- $pages = sort $pages "Date" "desc" -}}

{{- /* 6. _index.md에서 지정한 'count' (3개)만큼 잘라냅니다. */ -}}
{{- $n := or .content.count 9 -}}
{{- $pages = first $n $pages -}}

{{- /* 7. 필터링된 페이지만큼 반복하여, 지정된 뷰(a,b,c)로 렌더링합니다. */ -}}
{{- range $pages -}}
  {{ partial $tpl (dict "page" .) }}
{{- end -}}